<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>psy_view.ds_widget &mdash; psy-view 0.1.0+3.ge63209f documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> psy-view
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installing.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ncview.html">psy-view vs. ncview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../command_line.html">Command line usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/psy_view.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">ToDos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">psy-view</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
          <li><a href="../psy_view.html">psy_view</a> &raquo;</li>
      <li>psy_view.ds_widget</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for psy_view.ds_widget</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Dataset widget to display the contents of a dataset.&quot;&quot;&quot;</span>

<span class="c1"># Disclaimer</span>
<span class="c1"># ----------</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2021 Helmholtz-Zentrum Hereon</span>
<span class="c1"># Copyright (C) 2020-2021 Helmholtz-Zentrum Geesthacht</span>
<span class="c1">#</span>
<span class="c1"># This file is part of psy-view and is released under the GNU LGPL-3.O license.</span>
<span class="c1"># See COPYING and COPYING.LESSER in the root of the repository for full</span>
<span class="c1"># licensing details.</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License version 3.0 as</span>
<span class="c1"># published by the Free Software Foundation.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU LGPL-3.0 license for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU LGPL-3.0 license</span>
<span class="c1"># along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">osp</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Hashable</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">contextlib</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>  <span class="c1"># pylint: disable=no-name-in-module</span>
<span class="kn">import</span> <span class="nn">psy_view.utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">from</span> <span class="nn">psyplot_gui.content_widget</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DatasetTree</span><span class="p">,</span> <span class="n">DatasetTreeItem</span><span class="p">,</span> <span class="n">escape_html</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">psyplot_gui.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DockMixin</span><span class="p">,</span> <span class="n">get_icon</span> <span class="k">as</span> <span class="n">get_psy_icon</span><span class="p">,</span> <span class="n">PyErrorMessage</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">psyplot.data</span> <span class="k">as</span> <span class="nn">psyd</span>
<span class="kn">from</span> <span class="nn">psy_view.rcsetup</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">psy_view.plotmethods</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PlotMethodWidget</span><span class="p">,</span>
    <span class="n">MapPlotWidget</span><span class="p">,</span>
    <span class="n">Plot2DWidget</span><span class="p">,</span>
    <span class="n">LinePlotWidget</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">psyplot.config.rcsetup</span> <span class="kn">import</span> <span class="n">get_configdir</span>

<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">xarray</span> <span class="kn">import</span> <span class="n">DataArray</span><span class="p">,</span> <span class="n">Dataset</span>
    <span class="kn">from</span> <span class="nn">psyplot.project</span> <span class="kn">import</span> <span class="n">PlotterInterface</span><span class="p">,</span> <span class="n">Project</span>
    <span class="kn">from</span> <span class="nn">psyplot.plotter</span> <span class="kn">import</span> <span class="n">Plotter</span>
    <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backend_bases</span> <span class="kn">import</span> <span class="n">MouseEvent</span>
    <span class="kn">from</span> <span class="nn">psyplot_gui.main</span> <span class="kn">import</span> <span class="n">MainWindow</span>


<span class="n">NOTSET</span> <span class="o">=</span> <span class="s2">&quot;__NOVARIABLEAVAILABLE&quot;</span>


<div class="viewcode-block" id="get_dims_to_iterate"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.get_dims_to_iterate">[docs]</a><span class="k">def</span> <span class="nf">get_dims_to_iterate</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Get the dimensions of an array to iterate over</span>

<span class="sd">    This function takes a data array and returns the dimension in the base</span>
<span class="sd">    dataset that one can interator over.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr: xarray.DataArray</span>
<span class="sd">        The data array to iterate over</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list of strings</span>
<span class="sd">        The dimension strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_var</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">iter_base_variables</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dim</span> <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">base_var</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">base_var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">arr</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span></div>

<span class="n">TOO_MANY_FIGURES_WARNING</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Multiple figures are open but you specified only </span><span class="si">{}</span><span class="s2"> filenames: </span><span class="si">{}</span><span class="s2">.&lt;br&gt;</span>

<span class="s2">Saving the figures will cause that not all images are saved! We recommend to</span>
<span class="s2">export to a single PDF (that then includes multiple pages), or modify your</span>
<span class="s2">filename with strings like</span>

<span class="s2">&lt;ul&gt;</span>
<span class="s2">&lt;li&gt; &lt;code&gt;</span><span class="si">%i</span><span class="s2">&lt;/code&gt; for a continuous counter of the images&lt;/li&gt;</span>
<span class="s2">&lt;li&gt;&lt;code&gt;</span><span class="si">%(name)s</span><span class="s2">&lt;/code&gt; for variable names&lt;/li&gt;</span>
<span class="s2">&lt;li&gt;or other netCDF attributes (see the</span>
<span class="s2">  &lt;a href=&quot;https://psyplot.github.io/psyplot/api/psyplot.project.html#psyplot.project.Project.export&quot;&gt;</span>
<span class="s2">  examples of exporting psyplot projects&lt;/a&gt;)&lt;/li&gt;</span>
<span class="s2">&lt;/ul&gt;</span>

<span class="s2">Shall I continue anyway and save the figures?</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="DatasetWidget"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget">[docs]</a><span class="k">class</span> <span class="nc">DatasetWidget</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSplitter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A widget to control the visualization of the variables in a dataset&quot;&quot;&quot;</span>

    <span class="c1">#: The title of the widget</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;psy-view Plot Control&#39;</span>

    <span class="c1">#: Display the dock widget at the right side of the GUI</span>
    <span class="n">dock_position</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span>

    <span class="n">_animating</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_ani</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FuncAnimation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_init_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#: A :class:`PyQt5.QtWidgets.QGroupBox` that contains the variable buttons</span>
    <span class="n">variable_frame</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#: Buttons for selecting variables in the :attr:`ds`</span>
    <span class="n">variable_buttons</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">]</span>

    <span class="n">_new_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_preset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#: Attributes to use in the dataset tree</span>
    <span class="n">ds_attr_columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="s1">&#39;dims&#39;</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ds: xarray.Dataset</span>
<span class="sd">            A dataset to visualize with this widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ds_nums</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setChildrenCollapsible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">PyErrorMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># first row: dataset name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_ds</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbl_ds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_open</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="n">get_psy_icon</span><span class="p">(</span><span class="s1">&#39;run_arrow.png&#39;</span><span class="p">),</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset</span><span class="p">(),</span>
            <span class="s2">&quot;Select and open a netCDF dataset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_widget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_widget</span><span class="p">)</span>


        <span class="c1"># second row: dataset representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_ds_tree</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_ds_item</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span><span class="o">.</span><span class="n">itemExpanded</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_ds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span><span class="o">.</span><span class="n">itemExpanded</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_variable_desc</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span><span class="p">)</span>

        <span class="c1"># third row, navigation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="c1"># -- animate backwards button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_backward</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="s2">&quot;◀◀&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_backward</span><span class="p">(),</span>
            <span class="s2">&quot;Animate the time dimension backwards&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_backward</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># -- go to previous button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_prev</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="s1">&#39;◀&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">go_to_previous_step</span><span class="p">,</span>
            <span class="s2">&quot;Go to previous time step&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="p">)</span>

        <span class="c1"># -- dimension menu for animation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="p">)</span>

        <span class="c1"># -- go to next button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_next</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="s1">&#39;▶&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">go_to_next_step</span><span class="p">,</span>
            <span class="s2">&quot;Go to next time step&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="p">)</span>

        <span class="c1"># -- animate forward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_forward</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="s2">&quot;▶▶&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_forward</span><span class="p">(),</span>
            <span class="s2">&quot;Animate the time dimension&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_forward</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># -- interval slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSlider</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>  <span class="c1"># 24 fps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="o">.</span><span class="n">setPageStep</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_timer_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="p">)</span>

        <span class="c1"># -- interval label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_interval</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;500 ms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbl_interval</span><span class="p">)</span>

        <span class="c1"># --- export/import menus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_box</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="c1"># -- Export button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_export</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_export</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Export&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_export</span><span class="o">.</span><span class="n">setPopupMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="o">.</span><span class="n">InstantPopup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_export</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setup_export_menu</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_export</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_export</span><span class="p">)</span>

        <span class="c1"># --- Presets button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frm_preset</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frm_preset</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">StyledPanel</span><span class="p">)</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_preset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btn_preset</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_preset</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Preset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_preset</span><span class="o">.</span><span class="n">setPopupMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="o">.</span><span class="n">InstantPopup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_preset</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setup_preset_menu</span><span class="p">())</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_preset</span><span class="p">)</span>

        <span class="c1"># --- presets label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_preset</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_preset</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbl_preset</span><span class="p">)</span>

        <span class="c1"># --- unset preset button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_unset_preset</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="n">get_psy_icon</span><span class="p">(</span><span class="s1">&#39;invalid.png&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">unset_preset</span><span class="p">,</span>
            <span class="s2">&quot;Unset the current preset&quot;</span><span class="p">,</span> <span class="n">hbox</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_unset_preset</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">export_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_preset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btn_reload</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="n">get_psy_icon</span><span class="p">(</span><span class="s2">&quot;refresh.png&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">,</span>
            <span class="s2">&quot;Close all open datasets and recreate the plots&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_box</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">export_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">vbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

        <span class="c1"># fourth row: array selector</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">array_frame</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Current plot&#39;</span><span class="p">)</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_current_figure</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btn_add</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">get_psy_icon</span><span class="p">(</span><span class="s1">&#39;plus&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_plot</span><span class="p">,</span>
            <span class="s2">&quot;Create a new plot&quot;</span><span class="p">,</span> <span class="n">hbox</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_add</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_del</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">get_psy_icon</span><span class="p">(</span><span class="s1">&#39;minus&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_current_plot</span><span class="p">,</span>
            <span class="s2">&quot;Remove the current plot&quot;</span><span class="p">,</span> <span class="n">hbox</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_del</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_add</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_del</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array_frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array_frame</span><span class="p">)</span>

        <span class="c1"># fifth row: plot interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTabWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_plot_tabs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_tab</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="p">)</span>

        <span class="c1"># sixth row: variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_scroll</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_scroll</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_variable_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_scroll</span><span class="p">)</span>

        <span class="c1"># seventh row: dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_table</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_table</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">disable_navigation</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cids</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="DatasetWidget.reload"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Close the plot and recreate it.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">psyplot.project</span> <span class="k">as</span> <span class="nn">psy</span>

        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">dsnames_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">num</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">project</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">save_project</span><span class="p">()</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ds_nums</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span> <span class="o">=</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">psy</span><span class="o">.</span><span class="n">Project</span><span class="o">.</span><span class="n">load_project</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ds_nums</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">datasets</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">num</span> <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">dsnames_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_datasets</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds_nums</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_ds_item</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.setup_ds_tree"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.setup_ds_tree">[docs]</a>    <span class="k">def</span> <span class="nf">setup_ds_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Setup the number of columns and the header of the dataset tree.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span> <span class="o">=</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidget</span><span class="p">()</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_attr_columns</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">setHeaderLabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_attr_columns</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.showEvent"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.showEvent">[docs]</a>    <span class="k">def</span> <span class="nf">showEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">showEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">current_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">current_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">()</span>

        <span class="n">itree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span><span class="p">)</span>
        <span class="n">itable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_table</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">current_sizes</span><span class="p">[</span><span class="n">itree</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">+=</span> <span class="mi">400</span> <span class="o">-</span> <span class="n">current_sizes</span><span class="p">[</span><span class="n">itree</span><span class="p">]</span>
            <span class="n">current_sizes</span><span class="p">[</span><span class="n">itree</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="k">if</span> <span class="n">current_sizes</span><span class="p">[</span><span class="n">itable</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">+=</span> <span class="mi">300</span> <span class="o">-</span> <span class="n">current_sizes</span><span class="p">[</span><span class="n">itable</span><span class="p">]</span>
            <span class="n">current_sizes</span><span class="p">[</span><span class="n">itable</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">current_size</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">current_size</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">+</span> <span class="n">diff</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSizes</span><span class="p">(</span><span class="n">current_sizes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="DatasetWidget.close_current_plot"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.close_current_plot">[docs]</a>    <span class="k">def</span> <span class="nf">close_current_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Close the figure of the current variable.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.excepthook"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.excepthook">[docs]</a>    <span class="k">def</span> <span class="nf">excepthook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A method to replace the sys.excepthook&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_msg</span><span class="o">.</span><span class="n">excepthook</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">arr_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the name of the array of the current plot (if there is one).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="DatasetWidget.change_ds"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.change_ds">[docs]</a>    <span class="k">def</span> <span class="nf">change_ds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_item</span><span class="p">:</span> <span class="n">DatasetTreeItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Change the current dataset to another one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ds_item: psyplot_gui.content_widget.DatasetTreeItem</span>
<span class="sd">            The item in the tree of the new dataset to use</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ds_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_items</span>
        <span class="k">if</span> <span class="n">ds_item</span> <span class="ow">in</span> <span class="n">ds_items</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_tree</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds_item</span><span class="o">.</span><span class="n">ds</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_ds_item</span><span class="p">(</span><span class="n">ds_item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setup_variable_buttons</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">change_combo_array</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">reset_combo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.expand_ds_item"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.expand_ds_item">[docs]</a>    <span class="k">def</span> <span class="nf">expand_ds_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_item</span><span class="p">:</span> <span class="n">DatasetTreeItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Expand an item of a dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ds_item: DatasetTreeItem</span>
<span class="sd">            The item to expand</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">collapseAll</span><span class="p">()</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">expandItem</span><span class="p">(</span><span class="n">ds_item</span><span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds_item</span><span class="o">.</span><span class="n">ds</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">expandItem</span><span class="p">(</span><span class="n">ds_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">expandItem</span><span class="p">(</span><span class="n">ds_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">expandItem</span><span class="p">(</span><span class="n">ds_item</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Open a dialog to open a new dataset from disk.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xarray.Dataset or None</span>
<span class="sd">            The :class:`xarray.Dataset` of the selected file, or None if the</span>
<span class="sd">            user aborted the dialog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbl_ds</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">current</span><span class="p">):</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open dataset&#39;</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span>
            <span class="s1">&#39;NetCDF files (*.nc *.nc4);;&#39;</span>
            <span class="s1">&#39;Shape files (*.shp);;&#39;</span>
            <span class="s1">&#39;All files (*)&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">psyd</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ds</span>

<div class="viewcode-block" id="DatasetWidget.block_tree"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.block_tree">[docs]</a>    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">block_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Block all signals of a tree temporarily.</span>

<span class="sd">        Use this via::</span>

<span class="sd">            with self.block_tree():</span>
<span class="sd">                do_something</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">yield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.set_dataset"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.set_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">set_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Ask for a file name and open the dataset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_dataset</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_tree</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_ds_item</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_variable_buttons</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_add</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_del</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.add_ds_item"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.add_ds_item">[docs]</a>    <span class="k">def</span> <span class="nf">add_ds_item</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Add a new :class:`DatasetTreeItem` for the current :attr:`ds`.&quot;&quot;&quot;</span>
        <span class="n">ds</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_ds_item</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_add_ds_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span>
        <span class="n">ds_item</span> <span class="o">=</span> <span class="n">DatasetTreeItem</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_attr_columns</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">psyd</span><span class="o">.</span><span class="n">get_filename_ds</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbl_ds</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbl_ds</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ds_item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">addTopLevelItem</span><span class="p">(</span><span class="n">ds_item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expand_ds_item</span><span class="p">(</span><span class="n">ds_item</span><span class="p">)</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">resizeColumnToContents</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_datasets</span><span class="p">:</span>
            <span class="c1"># make sure we do not loose track of open datasets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ds_nums</span><span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">open_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a mapping from path to dataset number of the open datasets.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ds_nums</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ds_items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DatasetTreeItem</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the :class:`DatasetTreeItems` for the open datasets.&quot;&quot;&quot;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">())))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ds_item</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatasetTreeItem</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the current dataset item (if there is one).&quot;&quot;&quot;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">ds</span><span class="p">()</span> <span class="ow">is</span> <span class="n">ds</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">item</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="DatasetWidget.expand_current_variable"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.expand_current_variable">[docs]</a>    <span class="k">def</span> <span class="nf">expand_current_variable</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Expand the item in the dataset tree of variable.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable: str</span>
<span class="sd">            The name of the variable to expand. If None, the current variable is</span>
<span class="sd">            used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span>
        <span class="n">top</span><span class="p">:</span> <span class="n">DatasetTreeItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_item</span>  <span class="c1"># type: ignore</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">expandItem</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">expandItem</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>  <span class="c1"># type: ignore</span>
        <span class="k">for</span> <span class="n">var_item</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">child</span><span class="p">,</span>
                            <span class="nb">range</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">childCount</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">var_item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">variable</span><span class="p">:</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">expandItem</span><span class="p">(</span><span class="n">var_item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">collapseItem</span><span class="p">(</span><span class="n">var_item</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.setup_variable_buttons"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.setup_variable_buttons">[docs]</a>    <span class="k">def</span> <span class="nf">setup_variable_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ncols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Setup the variable buttons for the current dataset.&quot;&quot;&quot;</span>
        <span class="n">variable_frame</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Variables&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">variable_scroll</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">variable_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_frame</span> <span class="o">=</span> <span class="n">variable_frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>

        <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
                <span class="n">btn</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_pushbutton</span><span class="p">(</span>
                    <span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_variable</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Visualize variable </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">btn</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variable_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">i</span> <span class="o">//</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="n">ncols</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">//</span> <span class="n">ncols</span>
                <span class="n">minrows</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">rows</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variable_scroll</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">minrows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">btn</span><span class="o">.</span><span class="n">sizeHint</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">())</span></div>

<div class="viewcode-block" id="DatasetWidget.load_variable_desc"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.load_variable_desc">[docs]</a>    <span class="k">def</span> <span class="nf">load_variable_desc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load the description of the variable of a given tree item.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item: PyQt5.QtWidget.QTreeWidgetItem</span>
<span class="sd">            The item of the variable in the :attr:`ds_tree`. If this is not an</span>
<span class="sd">            item of a variable, nothing is done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span>

        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="n">tree</span> <span class="ow">or</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">DatasetTree</span><span class="o">.</span><span class="n">is_variable</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">or</span> <span class="n">DatasetTree</span><span class="o">.</span><span class="n">is_coord</span><span class="p">(</span><span class="n">item</span><span class="p">)):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">isColumnHidden</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">showColumn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">resizeColumnToContents</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">top</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">while</span> <span class="n">top</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">and</span> <span class="n">top</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">ds</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">escape_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)]))</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;pre&gt;&#39;</span> <span class="o">+</span> <span class="n">desc</span> <span class="o">+</span> <span class="s1">&#39;&lt;/pre&gt;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.clear_table"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.clear_table">[docs]</a>    <span class="k">def</span> <span class="nf">clear_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Clear the table that shows the available dimensions.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_table</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_table</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_table</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="s1">&#39;Current&#39;</span><span class="p">,</span> <span class="s1">&#39;Last&#39;</span><span class="p">,</span> <span class="s1">&#39;Units&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.addLayout"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.addLayout">[docs]</a>    <span class="k">def</span> <span class="nf">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">:</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLayout</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Add a layout to the splitter.</span>

<span class="sd">        This convenience function creates a new QWidget that wraps the given</span>
<span class="sd">        layout and returns it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layout: QtWidget.QLayout</span>
<span class="sd">            The layout to add</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        QtWidgets.QWidget</span>
<span class="sd">            The widget that wraps the given layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widget</span></div>

<div class="viewcode-block" id="DatasetWidget.go_to_previous_step"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.go_to_previous_step">[docs]</a>    <span class="k">def</span> <span class="nf">go_to_previous_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Decrease the movie dimension to the previous step.&quot;&quot;&quot;</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">increase_dim</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)()</span></div>

<div class="viewcode-block" id="DatasetWidget.go_to_next_step"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.go_to_next_step">[docs]</a>    <span class="k">def</span> <span class="nf">go_to_next_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Increase the movie dimension to the next step.&quot;&quot;&quot;</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">increase_dim</span><span class="p">(</span><span class="n">dim</span><span class="p">)()</span></div>

<div class="viewcode-block" id="DatasetWidget.animate_backward"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.animate_backward">[docs]</a>    <span class="k">def</span> <span class="nf">animate_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Start the current animation in backward direction, or stop it.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animating</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_backward</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;◀◀&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_navigation</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_animate_forward</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_backward</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;■&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_navigation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_backward</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_animation</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.animate_forward"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.animate_forward">[docs]</a>    <span class="k">def</span> <span class="nf">animate_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nframes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start the current animation in forward direction, or stop it.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animating</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_forward</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;▶▶&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_navigation</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_animate_forward</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_forward</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;■&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_navigation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_animate_forward</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_animation</span><span class="p">(</span><span class="n">nframes</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.setup_plot_tabs"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.setup_plot_tabs">[docs]</a>    <span class="k">def</span> <span class="nf">setup_plot_tabs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Setup the tabs of the various plot methods.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">MapPlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">),</span>
                              <span class="s1">&#39;mapplot&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">Plot2DWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">),</span>
                              <span class="s1">&#39;plot2d&#39;</span><span class="p">)</span>
        <span class="n">lineplot_widget</span> <span class="o">=</span> <span class="n">LinePlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">lineplot_widget</span><span class="p">,</span> <span class="s1">&#39;lineplot&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">replot</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">reset</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">())</span></div>

<div class="viewcode-block" id="DatasetWidget.replot"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.replot">[docs]</a>    <span class="k">def</span> <span class="nf">replot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotmethod</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Regenerate the plot of a given plotmethod, without closing it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plotmethod: str</span>
<span class="sd">            The name of the plotmethod</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        reset: The same method, but closes the plot before genereting a new one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span> <span class="o">=</span> <span class="n">plotmethod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.reset"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotmethod</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Close the plot of the given plotmethod and regenerate it.</span>

<span class="sd">        The same as :meth:`replot`, but closes the plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plotmethod: str</span>
<span class="sd">            The name of the plotmethod</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        reset: The same method, but closes the plot before genereting a new one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span> <span class="o">=</span> <span class="n">plotmethod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_sp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.disable_navigation"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.disable_navigation">[docs]</a>    <span class="k">def</span> <span class="nf">disable_navigation</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">but</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Disable the navigation buttons.</span>

<span class="sd">        This function disables all navigation buttons but the one you specify.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        but: PyQt5.QtWidgets.QPushButton</span>
<span class="sd">            If not None, this button is not disabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="o">.</span><span class="n">itemAt</span><span class="p">,</span>
                        <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">but</span> <span class="ow">and</span> <span class="n">w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.enable_navigation"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.enable_navigation">[docs]</a>    <span class="k">def</span> <span class="nf">enable_navigation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Enable all navigation buttons again.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="o">.</span><span class="n">itemAt</span><span class="p">,</span>
                        <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">navigation_box</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.disable_variables"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.disable_variables">[docs]</a>    <span class="k">def</span> <span class="nf">disable_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disable all variable selection buttons.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.enable_variables"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.enable_variables">[docs]</a>    <span class="k">def</span> <span class="nf">enable_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable all variable selection buttons again.&quot;&quot;&quot;</span>
        <span class="n">valid_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span><span class="o">.</span><span class="n">valid_variables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">v</span> <span class="ow">in</span> <span class="n">valid_variables</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.start_animation"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.start_animation">[docs]</a>    <span class="k">def</span> <span class="nf">start_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nframes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start the animation along the selected dimension.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nframes: int or None</span>
<span class="sd">            If not None, the number of frames to draw</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        animation_frames: The iterator to generate the frames</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation_frames</span> <span class="o">=</span> <span class="n">nframes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_starting_step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">event_source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dims</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">animation_frames</span><span class="p">(),</span>
                    <span class="n">init_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">draw</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span>
                    <span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># HACK: Make sure that the animation starts although the figure</span>
                <span class="c1"># is already shown</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">_draw_frame</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">animation_frames</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.reset_timer_interval"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.reset_timer_interval">[docs]</a>    <span class="k">def</span> <span class="nf">reset_timer_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Change the interval of the timer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_interval</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> ms&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">event_source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.stop_animation"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.stop_animation">[docs]</a>    <span class="k">def</span> <span class="nf">stop_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Stop the current animation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animating</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">animation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">event_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.animation_frames"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.animation_frames">[docs]</a>    <span class="k">def</span> <span class="nf">animation_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get the animation frames for the :attr:`combo_dims` dimension.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animating</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animation_frames</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_animation_frames</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animation_frames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_step</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_animation_frames</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">idims</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
            <span class="n">imax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_step</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init_step</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_starting_step</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_starting_step</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animate_forward</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="o">-</span><span class="n">i</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">imax</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="n">imax</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">yield</span> <span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span></div>

<div class="viewcode-block" id="DatasetWidget.update_dims"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.update_dims">[docs]</a>    <span class="k">def</span> <span class="nf">update_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_load_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Open a file dialog and load the selected preset.&quot;&quot;&quot;</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Load preset&#39;</span><span class="p">,</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_configdir</span><span class="p">(),</span> <span class="s1">&#39;presets&#39;</span><span class="p">),</span>
            <span class="s1">&#39;YAML files (*.yml *.yaml);;&#39;</span>
            <span class="s1">&#39;All files (*)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_preset</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

<div class="viewcode-block" id="DatasetWidget.load_preset"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.load_preset">[docs]</a>    <span class="k">def</span> <span class="nf">load_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]):</span>
        <span class="sd">&quot;&quot;&quot;Load a given preset from disk.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        preset: str or dict</span>
<span class="sd">            The name or path to the preset, or a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preset</span> <span class="o">=</span> <span class="n">preset</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">:</span>
            <span class="n">loaded_preset</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preset</span>  <span class="c1"># now that it&#39;s loaded</span>
            <span class="k">if</span> <span class="n">loaded_preset</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">load_preset</span><span class="p">(</span><span class="n">loaded_preset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maybe_show_preset</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">preset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the currently loaded preset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="kn">import</span> <span class="nn">psyplot.project</span> <span class="k">as</span> <span class="nn">psy</span>
        <span class="n">preset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preset</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">preset</span> <span class="o">=</span> <span class="n">psy</span><span class="o">.</span><span class="n">Project</span><span class="o">.</span><span class="n">_load_preset</span><span class="p">(</span><span class="n">preset</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">constructor</span><span class="o">.</span><span class="n">ConstructorError</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Can I trust this?&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to load the preset at &lt;i&gt;</span><span class="si">{</span><span class="n">preset</span><span class="si">}</span><span class="s2">&lt;/i&gt; in safe mode. Can we &quot;</span>
                <span class="s2">&quot;trust this preset and load it in unsafe mode?&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="n">psyd</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;presets.trusted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">psy</span><span class="o">.</span><span class="n">Project</span><span class="o">.</span><span class="n">_resolve_preset_path</span><span class="p">(</span><span class="n">preset</span><span class="p">))</span>
                <span class="n">preset</span> <span class="o">=</span> <span class="n">psy</span><span class="o">.</span><span class="n">Project</span><span class="o">.</span><span class="n">_load_preset</span><span class="p">(</span><span class="n">preset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">preset</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">preset</span>  <span class="c1"># type: ignore</span>

    <span class="nd">@preset</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preset</span> <span class="o">=</span> <span class="n">value</span>


<div class="viewcode-block" id="DatasetWidget.unset_preset"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.unset_preset">[docs]</a>    <span class="k">def</span> <span class="nf">unset_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Unset the current preset and do not use it anymore.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preset</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maybe_show_preset</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.maybe_show_preset"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.maybe_show_preset">[docs]</a>    <span class="k">def</span> <span class="nf">maybe_show_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Show the name of the current preset if one is selected.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_preset</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbl_preset</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&lt;i&gt;&#39;</span> <span class="o">+</span>
                <span class="n">osp</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_preset</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&lt;/i&gt;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbl_preset</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_unset_preset</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbl_preset</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&lt;i&gt;custom&lt;/i&gt;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbl_preset</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_unset_preset</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbl_preset</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_unset_preset</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.save_current_preset"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.save_current_preset">[docs]</a>    <span class="k">def</span> <span class="nf">save_current_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save the preset of the current plot to a file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">preset_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">save_preset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_preset</span><span class="p">(</span><span class="n">preset_func</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.save_full_preset"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.save_full_preset">[docs]</a>    <span class="k">def</span> <span class="nf">save_full_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save the preset of all open plots to a file.&quot;&quot;&quot;</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span>
        <span class="k">if</span> <span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_preset</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">save_preset</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_save_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save the preset to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_func: function</span>
<span class="sd">            The function that is called to save the preset. Must accept the</span>
<span class="sd">            path as an argument</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Save preset&#39;</span><span class="p">,</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_configdir</span><span class="p">(),</span> <span class="s1">&#39;presets&#39;</span><span class="p">),</span>
            <span class="s1">&#39;YAML files (*.yml *.yaml);;&#39;</span>
            <span class="s1">&#39;All files (*)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">save_func</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

<div class="viewcode-block" id="DatasetWidget.setup_preset_menu"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.setup_preset_menu">[docs]</a>    <span class="k">def</span> <span class="nf">setup_preset_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set up the menu to select/load presets.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preset_menu</span> <span class="o">=</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_preset_actions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_load_preset_action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;Load preset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_preset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unset_preset_action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;Unset preset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unset_preset</span><span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_save_preset_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Save format of current plot as preset&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">save_current_preset</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_preset_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Save format of all plots as preset&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">save_full_preset</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_preset_actions</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">menu</span></div>

<div class="viewcode-block" id="DatasetWidget.setup_export_menu"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.setup_export_menu">[docs]</a>    <span class="k">def</span> <span class="nf">setup_export_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set up the menu to export the current plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_menu</span> <span class="o">=</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;image (PDF, PNG, etc.)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_image</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;all images (PDF, PNG, etc.)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_all_images</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;animation (GIF, MP4, etc.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_animation</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;psyplot project (.pkl file)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_project</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;psyplot project with data&#39;</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">export_project_with_data</span><span class="p">)</span>
        <span class="n">py_action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;python script (.py)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_python</span><span class="p">)</span>
        <span class="n">py_action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># psyplot does not yet export to python</span>
        <span class="k">return</span> <span class="n">menu</span></div>

<div class="viewcode-block" id="DatasetWidget.export_image"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.export_image">[docs]</a>    <span class="k">def</span> <span class="nf">export_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Ask for a filename and export the current plot to a file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Export image&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;Images (*.png *.pdf *.jpg *.svg)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig_kws&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="DatasetWidget.export_all_images"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.export_all_images">[docs]</a>    <span class="k">def</span> <span class="nf">export_all_images</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Ask for a filename and export all plots to one (or more) files.&quot;&quot;&quot;</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Export image&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
            <span class="s2">&quot;Images (*.png *.pdf *.jpg *.svg)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">:</span>
            <span class="c1"># test filenames</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">:</span>
                <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">sp</span><span class="o">.</span><span class="n">format_string</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fnames</span><span class="p">)):</span>
                    <span class="n">answer</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Too many figures&quot;</span><span class="p">,</span>
                        <span class="n">TOO_MANY_FIGURES_WARNING</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fnames</span><span class="p">)),</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fnames</span><span class="p">))))</span>
                    <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
                        <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig_kws&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="DatasetWidget.export_animation"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.export_animation">[docs]</a>    <span class="k">def</span> <span class="nf">export_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Ask for a filename and export the animation.&quot;&quot;&quot;</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Export animation&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
            <span class="s2">&quot;Movie (*.mp4 *.mov *.gif)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">nframes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>  <span class="c1"># type: ignore</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_init_step</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animate_forward</span><span class="p">(</span><span class="n">nframes</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                    <span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;animations.export_kws&#39;</span><span class="p">],</span>
                    <span class="n">fps</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl_interval</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animate_forward</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DatasetWidget.export_project"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.export_project">[docs]</a>    <span class="k">def</span> <span class="nf">export_project</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Ask for a filename and export the psyplot project as .pkl file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Export project&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;Psyplot projects (*.pkl)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">save_project</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.export_project_with_data"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.export_project_with_data">[docs]</a>    <span class="k">def</span> <span class="nf">export_project_with_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Ask for a filename export project (incl. data) as .pkl file.</span>

<span class="sd">        Same as :meth:`export_project`, but adds the data to the pickle dump.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Export project&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;Psyplot projects (*.pkl)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">save_project</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">ds_description</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ds&quot;</span><span class="p">})</span></div>

<div class="viewcode-block" id="DatasetWidget.export_python"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.export_python">[docs]</a>    <span class="k">def</span> <span class="nf">export_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export the project as python file.</span>

<span class="sd">        This method is not yet implemented as the functionality is missing in</span>
<span class="sd">        psyplot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_draw_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;Visualize variable v&quot;&quot;&quot;</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">btn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_sp</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_widgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="p">):</span>
                        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">current</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_variable_buttons</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">var</span> <span class="o">!=</span> <span class="n">v</span><span class="p">:</span>
                            <span class="n">btn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_plot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">func</span>

<div class="viewcode-block" id="DatasetWidget.silence_variable_buttons"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.silence_variable_buttons">[docs]</a>    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">silence_variable_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Context manager to disable variable selection buttons.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_widgets</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>  <span class="c1"># type: ignore</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The current variable&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">btn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">NOTSET</span>

    <span class="nd">@variable</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_variable_buttons</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">available_plotmethods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the plotmethods that can visualize the selected variable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            A list of plotmethod names that can visualize the current</span>
<span class="sd">            :attr:`variable`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">NOTSET</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ds</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>  <span class="c1"># type: ignore</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">plot</span>
        <span class="k">for</span> <span class="n">plotmethod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethods</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotmethod</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">_plot_methods</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">plotmethod</span><span class="p">)</span><span class="o">.</span><span class="n">check_data</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="p">{})[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plotmethod</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlotterInterface</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the plotting function of the currently selected plotmethod.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No dataset has yet been selected, so no plot method!&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plot_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get further keyword arguments for the :attr:`plot` function.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span><span class="o">.</span><span class="n">get_fmts</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">preset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preset</span>
            <span class="k">if</span> <span class="n">preset</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">psyplot.project</span> <span class="k">as</span> <span class="nn">psy</span>
                <span class="n">preset</span> <span class="o">=</span> <span class="n">psy</span><span class="o">.</span><span class="n">Project</span><span class="o">.</span><span class="n">extract_fmts_from_preset</span><span class="p">(</span>
                    <span class="n">preset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">)</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">preset</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotmethod</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the name of the current plotmethod.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>

    <span class="nd">@plotmethod</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">plotmethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
                  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">label</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotmethods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a list of available plotmethods.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">())))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotmethod_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlotMethodWidget</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get widget of the current plotmethod.&quot;&quot;&quot;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
                  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">label</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotmethod_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PlotMethodWidget</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a list of available plotmethod widgets.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotmethods</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span>
                                              <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">()))))</span>

    <span class="n">_sp</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DatasetWidget.get_sp"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.get_sp">[docs]</a>    <span class="k">def</span> <span class="nf">get_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">]:</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span>
        <span class="k">if</span> <span class="n">sp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sp</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_sp</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.filter_sp"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.filter_sp">[docs]</a>    <span class="k">def</span> <span class="nf">filter_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">ds_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Filter the psyplot project to only include the arrays of :attr:`ds`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_plot</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sp</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">num</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">num</span><span class="p">]:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="n">sp</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ds_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="n">arr_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arr_name</span>
        <span class="k">if</span> <span class="n">arr_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">arr_name</span><span class="o">=</span><span class="n">arr_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.new_plot"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.new_plot">[docs]</a>    <span class="k">def</span> <span class="nf">new_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Select a new variable and make a plot.</span>

<span class="sd">        This method asks for a variable and them makes a new plot with the</span>
<span class="sd">        selected plotmethod.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        make_plot: plot the currently selected variable without asking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;New plot&#39;</span><span class="p">,</span> <span class="s1">&#39;Select a variable&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span><span class="o">.</span><span class="n">valid_variables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_variable_buttons</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">btn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">creating_new_plot</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_plot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_del</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.creating_new_plot"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.creating_new_plot">[docs]</a>    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">creating_new_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Tell that we are making a new plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">yield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_plot</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the psyplot project of the current plotmethod.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span><span class="o">.</span><span class="n">sp</span> <span class="ow">or</span> <span class="kc">None</span>

    <span class="nd">@sp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">sp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">)):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># first remove the current arrays</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sp</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sp</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">):</span>
                <span class="n">to_remove</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sp</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">)</span><span class="o">.</span><span class="n">arr_names</span>
                <span class="n">_sp</span><span class="p">:</span> <span class="n">Project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_sp</span><span class="p">)))):</span>
                    <span class="k">if</span> <span class="n">_sp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">arr_name</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
                        <span class="n">_sp</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># then add the new arrays</span>
            <span class="k">if</span> <span class="n">sp</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="n">new_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span> <span class="o">=</span> <span class="n">sp</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">psyd</span><span class="o">.</span><span class="n">InteractiveList</span><span class="p">,</span> <span class="n">DataArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the raw data of the current plot.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Plotter</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the psyplot plotter of the current plot.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span><span class="o">.</span><span class="n">plotter</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fig</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the figure of the current plot.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">figs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">_animations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FuncAnimation</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">animation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FuncAnimation</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the animation of the current plotmethod.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">)</span>

    <span class="nd">@animation</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ani</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FuncAnimation</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">ani</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_animations</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_animations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">]</span> <span class="o">=</span> <span class="n">ani</span>

<div class="viewcode-block" id="DatasetWidget.make_plot"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.make_plot">[docs]</a>    <span class="k">def</span> <span class="nf">make_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Make or update the plot of the current variable.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        new_plot: A function to select the variable first</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plotmethods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_plotmethods</span>
        <span class="n">plotmethod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span>
        <span class="k">if</span> <span class="n">plotmethod</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotmethods</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plotmethods</span><span class="p">:</span>
                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Visualization impossible&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Found no plotmethod for variable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">plotmethod</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Choose a plot method&quot;</span><span class="p">,</span> <span class="s2">&quot;Plot method:&quot;</span><span class="p">,</span> <span class="n">plotmethods</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span> <span class="o">=</span> <span class="n">plotmethod</span>
        <span class="n">new_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>
        <span class="n">fmts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dims</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">:</span>
            <span class="n">ds</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">new_v</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_sp</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">new_v</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">idims</span><span class="p">):</span>
                    <span class="n">dims</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">idims</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">new_v</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">):</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">idims</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="o">**</span><span class="n">fmts</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">replot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="o">**</span><span class="n">fmts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_fig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="o">=</span> <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">cid</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">plotters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
                <span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">]</span> <span class="o">=</span> <span class="n">cid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_fig</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
            <span class="n">descr</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">_short_info</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_widgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand_current_variable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_navigation</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.block_widgets"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.block_widgets">[docs]</a>    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">block_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">widgets</span><span class="p">:</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Temporarilly block all signals for the given widgets.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">yield</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.display_line"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.display_line">[docs]</a>    <span class="k">def</span> <span class="nf">display_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">MouseEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Display the line when clicked on a 2D-plot.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span>
                              <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
                <span class="k">if</span> <span class="n">widget</span><span class="o">.</span><span class="n">sp</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="n">widget</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
                    <span class="n">sl</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span>
            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">psy</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sl</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">widget</span><span class="o">.</span><span class="n">plotmethod</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mapplot&#39;</span><span class="p">,</span> <span class="s1">&#39;plot2d&#39;</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">raw_data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="c1"># check if the mappable contains the event</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mappable</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="s1">&#39;_wrapped_plot&#39;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">_wrapped_plot</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">return</span>
            <span class="n">current_pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span> <span class="o">=</span> <span class="s1">&#39;lineplot&#39;</span>
            <span class="n">linewidget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span>
            <span class="n">xdim</span> <span class="o">=</span> <span class="n">linewidget</span><span class="o">.</span><span class="n">xdim</span>
            <span class="k">if</span> <span class="n">xdim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">linewidget</span><span class="o">.</span><span class="n">sp</span> <span class="ow">or</span> <span class="p">(</span><span class="n">linewidget</span><span class="o">.</span><span class="n">xdim</span> <span class="ow">and</span>
                                     <span class="n">linewidget</span><span class="o">.</span><span class="n">xdim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">dims</span><span class="p">):</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_variable_buttons</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">btn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">variable</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_plot</span><span class="p">()</span>
                <span class="n">linewidget</span><span class="o">.</span><span class="n">xdim</span> <span class="o">=</span> <span class="n">xdim</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linewidget</span><span class="o">.</span><span class="n">xdim</span> <span class="o">=</span> <span class="n">xdim</span>
                <span class="n">linewidget</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="o">**</span><span class="n">sl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span> <span class="o">=</span> <span class="n">current_pm</span></div>


<div class="viewcode-block" id="DatasetWidget.close_sp"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.close_sp">[docs]</a>    <span class="k">def</span> <span class="nf">close_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Close the current subproject.&quot;&quot;&quot;</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">figs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ds</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.show_current_figure"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.show_current_figure">[docs]</a>    <span class="k">def</span> <span class="nf">show_current_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Show figure of the current plotmethod.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_fig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.show_fig"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.show_fig">[docs]</a>    <span class="k">def</span> <span class="nf">show_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="n">Project</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Show the first figure in a psyplot project.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">plotters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">window</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">window</span><span class="p">()</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">sp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.switch_tab"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.switch_tab">[docs]</a>    <span class="k">def</span> <span class="nf">switch_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Select a valid variable when switching the plotmethod tabs.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_variable_buttons</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">NOTSET</span>
            <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.change_combo_array"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.change_combo_array">[docs]</a>    <span class="k">def</span> <span class="nf">change_combo_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update the iteration dimension depending on the selected variable.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_widgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="p">):</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_sp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">,</span> <span class="n">ds_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sp</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">arr_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">arr_names</span><span class="p">:</span>
                <span class="n">new_arr</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">arr_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">all_arrays</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx_arr</span> <span class="o">=</span> <span class="n">all_arrays</span><span class="o">.</span><span class="n">arr_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_arr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">idx_arr</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx_arr</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">vname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>
                <span class="k">if</span> <span class="n">vname</span> <span class="o">!=</span> <span class="n">NOTSET</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">expand_current_variable</span><span class="p">(</span><span class="n">vname</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show_fig</span><span class="p">(</span><span class="n">sp</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="DatasetWidget.reset_combo_array"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.reset_combo_array">[docs]</a>    <span class="k">def</span> <span class="nf">reset_combo_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Clear and fill the iteration dimension based on :attr:`ds`.&quot;&quot;&quot;</span>
        <span class="n">curr_arr_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arr_name</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_widgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">:</span>
                <span class="n">all_arrays</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">)</span>
                <span class="n">current_ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>
                <span class="k">if</span> <span class="n">all_arrays</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">all_arrays</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">_short_info</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">curr_arr_name</span> <span class="ow">in</span> <span class="n">all_arrays</span><span class="o">.</span><span class="n">arr_names</span><span class="p">:</span>
                        <span class="n">idx_arr</span> <span class="o">=</span> <span class="n">all_arrays</span><span class="o">.</span><span class="n">arr_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">curr_arr_name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">combo_array</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx_arr</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">idx_arr</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">all_arrays</span><span class="p">[</span><span class="n">idx_arr</span><span class="p">:</span><span class="n">idx_arr</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">current_ds</span><span class="p">:</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_tree</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">expand_ds_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_item</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">expand_current_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.refresh"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reset_combo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Refresh the state of this widget.</span>

<span class="sd">        This method refreshes the widget based on the selected project,</span>
<span class="sd">        variable, etc.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reset_combo: bool</span>
<span class="sd">            If True (default), the :meth:`reset_combo_array` is called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_table</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">reset_combo</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_combo_array</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_preset_actions</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_del</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_export</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_preset_actions</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_del</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_export</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


        <span class="c1"># refresh variable buttons</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_variable_buttons</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">variable</span><span class="p">)</span>

        <span class="c1"># refresh tabs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tabs</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="p">:</span>
            <span class="n">valid_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span><span class="o">.</span><span class="n">valid_variables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">v</span> <span class="ow">in</span> <span class="n">valid_variables</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">variable</span> <span class="o">==</span> <span class="n">NOTSET</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_table</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="n">ds_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">]</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">silence_variable_buttons</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variable_buttons</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">dims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_data</span><span class="o">.</span><span class="n">dims</span>  <span class="c1"># type: ignore</span>
            <span class="n">table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">ds_data</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">setVerticalHeaderLabels</span><span class="p">(</span><span class="n">ds_data</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>

            <span class="c1"># set time, z, x, y info</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s1">&#39;XYTZ&#39;</span><span class="p">:</span>
                <span class="n">cname</span> <span class="o">=</span> <span class="n">ds_data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">get_dim</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cname</span> <span class="ow">and</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span>
                        <span class="n">dims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cname</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dims</span><span class="p">):</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">coord</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:1.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">coord</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">coord</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">first</span><span class="p">))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">last</span><span class="p">))</span>

                <span class="n">current</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">idims</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_dimension_button</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="n">current</span><span class="p">]))</span>

            <span class="c1"># update animation checkbox</span>
            <span class="n">dims_to_animate</span> <span class="o">=</span> <span class="n">get_dims_to_iterate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">current_dims_to_animate</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">itemText</span><span class="p">,</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">count</span><span class="p">())))</span>
            <span class="k">if</span> <span class="n">dims_to_animate</span> <span class="o">!=</span> <span class="n">current_dims_to_animate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">combo_dims</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">dims_to_animate</span><span class="p">)</span>

        <span class="n">table</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

        <span class="c1"># update plots items</span>
        <span class="k">for</span> <span class="n">ds_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_items</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="n">ds_item</span><span class="o">.</span><span class="n">child</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">ds_item</span><span class="o">.</span><span class="n">childCount</span><span class="p">())):</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">childCount</span><span class="p">())):</span>
                    <span class="k">if</span> <span class="n">DatasetTree</span><span class="o">.</span><span class="n">is_variable</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
                        <span class="n">plots_item</span> <span class="o">=</span> <span class="n">ds_item</span><span class="o">.</span><span class="n">get_plots_item</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                        <span class="n">ds_item</span><span class="o">.</span><span class="n">refresh_plots_item</span><span class="p">(</span>
                            <span class="n">plots_item</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidget.new_dimension_button"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.new_dimension_button">[docs]</a>    <span class="k">def</span> <span class="nf">new_dimension_button</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">utils</span><span class="o">.</span><span class="n">QRightPushButton</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate a new button to increase of decrease a dimension.&quot;&quot;&quot;</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">QRightPushButton</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">increase_dim</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
        <span class="n">btn</span><span class="o">.</span><span class="n">rightclicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">increase_dim</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">btn</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Increase dimension </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2"> with left-click, and &quot;</span>
                       <span class="s2">&quot;decrease with right-click.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">btn</span></div>

<div class="viewcode-block" id="DatasetWidget.update_project"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.update_project">[docs]</a>    <span class="k">def</span> <span class="nf">update_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update the correct project :attr:`sp` and refresh the widget.&quot;&quot;&quot;</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span>
        <span class="k">if</span> <span class="n">sp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidget.increase_dim"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidget.increase_dim">[docs]</a>    <span class="k">def</span> <span class="nf">increase_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">increase</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a function to update a specific dimension.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dim: str</span>
<span class="sd">            The dimension name</span>
<span class="sd">        increase: int</span>
<span class="sd">            The number of steps to increase (or decrease) the given `dim`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">update</span><span class="p">():</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">idims</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">increase</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">dim</span><span class="p">]})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">replot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">update</span></div></div>


<div class="viewcode-block" id="DatasetWidgetStandAlone"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetStandAlone">[docs]</a><span class="k">class</span> <span class="nc">DatasetWidgetStandAlone</span><span class="p">(</span><span class="n">DatasetWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A :class:`DatasetWidget` that is supposed to work as a standalone GUI&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DatasetWidgetStandAlone.closeEvent"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetStandAlone.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reimplemented close event to stop the running ``QApplication``.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div></div>


<div class="viewcode-block" id="DatasetWidgetPlugin"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetPlugin">[docs]</a><span class="k">class</span> <span class="nc">DatasetWidgetPlugin</span><span class="p">(</span><span class="n">DatasetWidget</span><span class="p">,</span> <span class="n">DockMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A :class:`DatasetWidget` plugin for the psyplot GUI.</span>

<span class="sd">    This widget can be embeded in the psyplot GUI. Different from the standalone</span>
<span class="sd">    :class:`DatasetWidget` class, this one here uses the current psyplot project</span>
<span class="sd">    (:func:`psyplot.project.gcp`)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: The title of the widget</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;psy-view Dataset viewer&#39;</span>

    <span class="c1">#: Display the dock widget at the right side of the GUI</span>
    <span class="n">dock_position</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">psyplot.project</span> <span class="k">as</span> <span class="nn">psy</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">psy</span><span class="o">.</span><span class="n">Project</span><span class="o">.</span><span class="n">oncpchange</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oncpchange</span><span class="p">)</span>

    <span class="nd">@property</span>  <span class="c1"># type: ignore</span>
    <span class="k">def</span> <span class="nf">_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="kn">import</span> <span class="nn">psyplot.project</span> <span class="k">as</span> <span class="nn">psy</span>
        <span class="k">return</span> <span class="n">psy</span><span class="o">.</span><span class="n">gcp</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@_sp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the psyplot project of the current plotmethod.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod_widget</span><span class="o">.</span><span class="n">sp</span> <span class="ow">or</span> <span class="kc">None</span>

    <span class="nd">@sp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">]):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sp</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">,</span> <span class="p">[]):</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># first remove the current arrays</span>
            <span class="k">if</span> <span class="n">current</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">):</span>
                <span class="n">to_remove</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sp</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">)</span><span class="o">.</span><span class="n">arr_names</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">)))):</span>
                    <span class="k">if</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">arr_name</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># then add the new arrays</span>
            <span class="k">if</span> <span class="n">sp</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="n">new_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current</span> <span class="o">=</span> <span class="n">sp</span>
            <span class="n">current</span><span class="o">.</span><span class="n">oncpchange</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">open_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a mapping from path to dataset number of the open datasets.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="o">.</span><span class="n">datasets</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ds_nums</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

<div class="viewcode-block" id="DatasetWidgetPlugin.close_sp"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetPlugin.close_sp">[docs]</a>    <span class="k">def</span> <span class="nf">close_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close_sp</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidgetPlugin.reload"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetPlugin.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Close the plot and recreate it.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">psyplot.project</span> <span class="k">as</span> <span class="nn">psy</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="o">.</span><span class="n">dsnames_map</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="c1"># we have datasets that only exist in memory, so better ask</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Shall I close this?&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Reloading the data closes all open plots. Any data in the memory &quot;</span>
                <span class="s2">&quot;is lost and open files are reloaded from disk! &quot;</span>
                <span class="s2">&quot;Shall I really continue?&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">answer</span> <span class="o">!=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">dsnames_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">num</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">project</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">save_project</span><span class="p">()</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ds_nums</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span> <span class="o">=</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">psy</span><span class="o">.</span><span class="n">Project</span><span class="o">.</span><span class="n">load_project</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">num</span> <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">dsnames_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_datasets</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidgetPlugin.oncpchange"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetPlugin.oncpchange">[docs]</a>    <span class="k">def</span> <span class="nf">oncpchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update this widget from the current psyplot main (or sub) project.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_combo_array</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">psy</span><span class="o">.</span><span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_navigation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_variable_buttons</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_add</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_del</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_navigation</span><span class="p">()</span></div>

<div class="viewcode-block" id="DatasetWidgetPlugin.show_fig"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetPlugin.show_fig">[docs]</a>    <span class="k">def</span> <span class="nf">show_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Show the figure of the the current subproject.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">psyplot_gui.main</span> <span class="kn">import</span> <span class="n">mainwindow</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">show_fig</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mainwindow</span><span class="o">.</span><span class="n">figures</span> <span class="ow">and</span> <span class="n">sp</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dock</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">plotters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">window</span>
                <span class="n">dock</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">show_plugin</span><span class="p">()</span>
                <span class="n">dock</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="DatasetWidgetPlugin.setup_ds_tree"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetPlugin.setup_ds_tree">[docs]</a>    <span class="k">def</span> <span class="nf">setup_ds_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Setup the number of columns and the header of the dataset tree.</span>

<span class="sd">        Reimplemented to use the :class:`psyplot_gui.content_widget.DatasetTree`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds_tree</span> <span class="o">=</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">DatasetTree</span><span class="p">()</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_attr_columns</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">setHeaderLabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_attr_columns</span><span class="p">)</span></div>

<div class="viewcode-block" id="DatasetWidgetPlugin.position_dock"><a class="viewcode-back" href="../../api/psy_view.ds_widget.html#psy_view.ds_widget.DatasetWidgetPlugin.position_dock">[docs]</a>    <span class="k">def</span> <span class="nf">position_dock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main</span><span class="p">:</span> <span class="n">MainWindow</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">help_explorer</span><span class="o">.</span><span class="n">dock</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="n">main</span><span class="o">.</span><span class="n">splitDockWidget</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">help_explorer</span><span class="o">.</span><span class="n">dock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dock</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="s1">&#39;resizeDocks&#39;</span><span class="p">):</span>  <span class="c1"># qt &gt;= 5.6</span>
            <span class="n">main</span><span class="o">.</span><span class="n">resizeDocks</span><span class="p">([</span><span class="n">main</span><span class="o">.</span><span class="n">help_explorer</span><span class="o">.</span><span class="n">dock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dock</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 Helmholtz-Zentrum Hereon, 2020-2021 Helmholtz-Zentrum Geesthacht.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>